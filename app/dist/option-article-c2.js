window.topolr.source({"packet":[{"p":"option.article","h":"9e4d63a8ef","c":"/* \n * @packet option.article;\n * @require site.admin;\n */\nOption({\n    name:\"page\",\n    option:{\n        modules:[\n            {type:\"@admin.adminhead\"},\n            {type:\"@admin.articlelist\"},\n            {type:\"@admin.copyright\"}\n        ]\n    }\n});"},{"p":"site.admin","h":"088963cda8","c":"/**\n * @packet site.admin;\n * @require site.service.admin;\n * @require site.service.base;\n * @require site.service.apiconfig;\n * @require util.uikit;\n * @require util.images;\n * @require util.editor;\n * @template site.template.admintemp;\n * @css site.style.main;\n */\nModule({\n    name: \"login\",\n    extend: \"view\",\n    className: \"login\",\n    template: \"@admintemp.login\",\n    services:{\n        admin:\"@admin.userservice\"\n    },\n    init: function () {\n        this.render();\n    },\n    find_submit: function (dom) {\n        dom.click(function () {\n            var un = this.finders(\"username\").val();\n            var pw = this.finders(\"password\").val();\n            if (un && pw) {\n                this.getService(\"admin\").trigger(\"login\",{username: un, password: pw}).scope(this).done(function (a) {\n                    this.dispatchEvent(\"redirectPage\", {\n                        url: \"admin\"\n                    });\n                }).fail(function () {\n                    $.toast(\"username or password is not matched\");\n                });\n            }else{\n                $.toast(\"username or password can not empty\");\n            }\n        }.bind(this));\n    }\n});\nModule({\n    name: \"adminhead\",\n    extend: \"view\",\n    className: \"adminhead\",\n    template: \"@admintemp.adminhead\",\n    init: function () {\n        var ths = this;\n        this.render();\n        this.dom.find(\"a\").each(function () {\n            $(this).click(function (e) {\n                ths.dispatchEvent(\"openPage\", {\n                    url: $(this).attr(\"href\")\n                });\n                e.preventDefault();\n            });\n        });\n    }\n});\nModule({\n    name: \"articlelist\",\n    extend: \"view\",\n    className: \"list\",\n    template: \"@admintemp.articlelist\",\n    autodom:true,\n    services:{\n        scroll:\"@base.scrollservice\",\n        list:\"@base.listservice\"\n    },\n    option: {\n        service_list:{\n            url:require(\"@apiconfig\").get(\"articlelist\"),\n            detail:require(\"@apiconfig\").get(\"articledetail\"),\n            pagesize:10\n        }\n    },\n    init: function () {\n        this.getService(\"list\").trigger(\"gotopage\", 0).scope(this).done(function () {\n            this.dispatchEvent(\"listdone\");\n        });\n    },\n    bind_add:function (dom) {\n        this.dispatchEvent(\"openPage\",{\n            url:\"admin/addarticle\"\n        });\n    },\n    onnodeinserted: function (dom) {\n        var ths = this;\n        $(dom).find(\"a\").each(function () {\n            $(this).click(function (e) {\n                console.log($(this).group().cache())\n                ths.dispatchEvent(\"openPage\", {\n                    url: $(this).attr(\"href\"),\n                    data: $(this).group().cache()\n                });\n                e.preventDefault();\n            });\n        });\n    },\n    group_item:function (dom) {\n        dom.items(\"remove\").click(function () {\n            console.log($(this).group().cache())\n        })\n    },\n    service_scroll:function () {\n        var a = this.finders(\"loading\").get(0).offsetTop;\n        if (a && $(\"body\").scrollTop() > this.finders(\"loading\").get(0).offsetTop - $(window).height()) {\n            this.finders(\"loading\").show();\n            this.getService(\"list\").trigger(\"next\").scope(this).always(function () {\n                this.finders(\"loading\").hide();\n            });\n        }\n    },\n    service_firstpage:function () {\n        this.dispatchEvent(\"listdone\");\n    }\n});\nModule({\n    name: \"editarticle\",\n    extend: [\"viewgroup\",\"@editor.mdeditor\"],\n    className: \"editarticle\",\n    layout: \"@admintemp.editarticle\",\n    autodom:true,\n    services:{\n        \"article\":\"@admin.articleservice\"\n    },\n    option: {\n        imageType: \"@images.imagesuploader\"\n    },\n    find_editor: function (dom) {\n        this.setEditor(dom);\n    },\n    find_submit: function (dom) {\n        dom.click(function () {\n            var title = this.groups(\"title\").items(\"input\").val();\n            var desc = this.groups(\"desc\").items(\"input\").val();\n            var content = this.editor.getValue();\n            var checked = false;\n            if (title) {\n                if (desc) {\n                    if (content) {\n                        checked = true;\n                    } else {\n                        $.toast(\"content can not empty\");\n                    }\n                } else {\n                    $.toast(\"desc can not empty\");\n                }\n            } else {\n                $.toast(\"title can not empty\");\n            }\n            if (checked) {\n                var t = {\n                    title: title,\n                    desc: desc,\n                    content: content\n                };\n                if (this.onsubmit) {\n                    t = this.onsubmit(t);\n                }\n                $.loadingbar().showLoading();\n                this.getChildAt(0).upload(t, function () {\n                    $.loadingbar().showSuccess();\n                }, function () {\n                    $.loadingbar().showError();\n                });\n            }\n        }.bind(this));\n    },\n    setContent: function (data) {\n        this.update(data);\n    },\n    onsubmit:function (t) {\n        var query=$.serialize.queryObject(window.location.href);\n        if (query) {\n            return $.extend(t,{\n                id:query.id\n            });\n        }else{\n            return t;\n        }\n    },\n    event_editdone:function () {\n        var query=$.serialize.queryObject(window.location.href);\n        if (query) {\n            this.getChildAt(0).option.url=sitePath+\"/api/admin/article/edit\";\n            this.getService(\"article\").trigger(\"fetch\",query).scope(this).then(function (t) {\n                this.update(t);\n            },function (a) {\n                console.log(a)\n            });\n        }\n    }\n});\nModule({\n    name: \"edituserinfo\",\n    extend: [\"view\",\"@editor.mdeditor\"],\n    className: \"editarticle\",\n    template: \"@admintemp.edituserinfo\",\n    services:{\n        user:\"@admin.userservice\"\n    },\n    init: function () {\n        this.render();\n    },\n    find_editor: function (dom) {\n        this.setEditor(dom);\n    },\n    find_submit: function (dom) {\n        dom.click(function () {\n            var content = this.editor.getValue();\n            var checked = false;\n            if (content) {\n                checked = true;\n            } else {\n                $.toast(\"content can not empty\");\n            }\n            if (checked) {\n                this.info.userinfomd = content;\n                $.loadingbar().showLoading();\n                this.getService(\"user\").trigger(\"edit\",this.info).scope(this).done(function () {\n                    $.loadingbar().showSuccess();\n                }).fail(function () {\n                    $.loadingbar().showError();\n                });\n            }\n        }.bind(this));\n    },\n    setContent: function (data) {\n        this.editor.setValue(data);\n    },\n    event_editdone: function () {\n        var data=this.getService(\"user\").action(\"get\")\n        this.info = data[0];\n        this.editor.setValue(data[0].userinfomd);\n    }\n});\nModule({\n    name: \"noadminhead\",\n    extend: \"view\",\n    className: \"adminhead\",\n    template: \"@admintemp.noadminhead\",\n    init: function () {\n        this.render();\n    }\n});\nModule({\n    name: \"copyright\",\n    extend: \"view\",\n    className: \"copyright\",\n    template: \"@admintemp.copyright\",\n    init: function () {\n        this.render();\n    }\n});"},{"p":"site.service.admin","h":"05e4c3b4e4","c":"/**\n * @packet site.service.admin;\n * @require site.service.apiconfig;\n */\nModule({\n    name:\"userservice\",\n    extend:\"publicservice\",\n    init:function () {\n        this.start();\n    },\n    service_login:function (data) {\n        this.stop();\n        return this.postRequest(require(\"@apiconfig\").get(\"login\"),data).scope(this).then(function (a) {\n            this.start();\n            this.data=a;\n            return a;\n        },function (a) {\n            this.start();\n            return a;\n        });\n    },\n    service_edit:function (data) {\n        this.stop();\n        return this.postRequest(require(\"@apiconfig\").get(\"edituserinfo\"),data).scope(this).then(function (a) {\n            this.start();\n            $.extend(this.data,data);\n            return a;\n        },function (a) {\n            this.start();\n            return a;\n        });\n    }\n});\nModule({\n    name:\"articleservice\",\n    extend:\"privateservice\",\n    init:function () {\n        this.start();\n    },\n    service_fetch:function (query) {\n        this.stop();\n        return this.postRequest(require(\"@apiconfig\").get(\"articledetail\"),query).scope(this).then(function (e) {\n            this.start();\n            return e;\n        },function () {\n            this.start();\n            promise.reject(e);\n        });\n    }\n});"},{"p":"util.images","h":"f44aa191db","c":"/**\n * @packet util.images;\n * @require util.file;\n * @css util.style.images;\n * @template util.template.imagestemp;\n */\nModule({\n    name: \"imagesuploader\",\n    className: \"imagesuploader\",\n    extend: \"view\",\n    autodom:true,\n    option: {\n        url: sitePath + \"api/admin/article/add\",\n        filename: \"file\",\n        label: \"upload image\",\n        height: \"300px\"\n    },\n    template: \"@imagestemp.imagesuploader\",\n    init: function () {\n        this._file = null;\n        this.render(this.option);\n    },\n    bind_file: function (dom, e) {\n        var ths = this;\n        var file = e.target.files || e.dataTransfer.files;\n        var _file = require(\"@file\")(file[0]), has = false;\n        if (this._file && this._file.getFileName() === _file.getFileName()) {\n            has = true;\n        }\n        if (!has) {\n            this._file = _file;\n            this.update({\n                label:this.option.label,\n                height:this.option.height,\n                image:_file.getFileURL()\n            });\n        }\n    },\n    setImage: function (src) {\n        this.update({\n            label:this.option.label,\n            height:this.option.height,\n            image:src\n        });\n    },\n    upload: function (data, fn, error) {\n        var ths = this;\n        if (this._file) {\n            this._file.uploadAsForm({\n                url: ths.option.url,\n                name: \"file\",\n                asysn: true,\n                data: data,\n                out: 6000000,\n                progress: function (e) {\n                    ths.dom.find(\".imageuploader-progress\").width(e.percent + \"%\");\n                },\n                error: function (a) {\n                    error && error(a);\n                },\n                success: function (data) {\n                    ths.dom.find(\".imageuploader-progress\").width(0);\n                    fn && fn(data.data);\n                }\n            });\n        } else {\n            this.postRequest(this.option.url, data).data(function (a) {\n                fn && fn(a);\n            }).bad(function () {\n                error && error();\n            }).error(function () {\n                error && error();\n            });\n        }\n    }\n});\n\n"},{"p":"util.file","h":"49e3d25029","c":"/*!\n * @packet util.file;\n */\nvar md5 = '!function(a){if(\"object\"==typeof exports)module.exports=a();else if(\"function\"==typeof define&&define.amd)define(a);else{var b;try{b=window}catch(c){b=self}b.SparkMD5=a()}}(function(a){function b(a,b,c,d,e,f){return b=t(t(b,a),t(d,f)),t(b<<e|b>>>32-e,c)}function c(a,c,d,e,f,g,h){return b(c&d|~c&e,a,c,f,g,h)}function d(a,c,d,e,f,g,h){return b(c&e|d&~e,a,c,f,g,h)}function e(a,c,d,e,f,g,h){return b(c^d^e,a,c,f,g,h)}function f(a,c,d,e,f,g,h){return b(d^(c|~e),a,c,f,g,h)}function g(a,b){var g=a[0],h=a[1],i=a[2],j=a[3];g=c(g,h,i,j,b[0],7,-680876936),j=c(j,g,h,i,b[1],12,-389564586),i=c(i,j,g,h,b[2],17,606105819),h=c(h,i,j,g,b[3],22,-1044525330),g=c(g,h,i,j,b[4],7,-176418897),j=c(j,g,h,i,b[5],12,1200080426),i=c(i,j,g,h,b[6],17,-1473231341),h=c(h,i,j,g,b[7],22,-45705983),g=c(g,h,i,j,b[8],7,1770035416),j=c(j,g,h,i,b[9],12,-1958414417),i=c(i,j,g,h,b[10],17,-42063),h=c(h,i,j,g,b[11],22,-1990404162),g=c(g,h,i,j,b[12],7,1804603682),j=c(j,g,h,i,b[13],12,-40341101),i=c(i,j,g,h,b[14],17,-1502002290),h=c(h,i,j,g,b[15],22,1236535329),g=d(g,h,i,j,b[1],5,-165796510),j=d(j,g,h,i,b[6],9,-1069501632),i=d(i,j,g,h,b[11],14,643717713),h=d(h,i,j,g,b[0],20,-373897302),g=d(g,h,i,j,b[5],5,-701558691),j=d(j,g,h,i,b[10],9,38016083),i=d(i,j,g,h,b[15],14,-660478335),h=d(h,i,j,g,b[4],20,-405537848),g=d(g,h,i,j,b[9],5,568446438),j=d(j,g,h,i,b[14],9,-1019803690),i=d(i,j,g,h,b[3],14,-187363961),h=d(h,i,j,g,b[8],20,1163531501),g=d(g,h,i,j,b[13],5,-1444681467),j=d(j,g,h,i,b[2],9,-51403784),i=d(i,j,g,h,b[7],14,1735328473),h=d(h,i,j,g,b[12],20,-1926607734),g=e(g,h,i,j,b[5],4,-378558),j=e(j,g,h,i,b[8],11,-2022574463),i=e(i,j,g,h,b[11],16,1839030562),h=e(h,i,j,g,b[14],23,-35309556),g=e(g,h,i,j,b[1],4,-1530992060),j=e(j,g,h,i,b[4],11,1272893353),i=e(i,j,g,h,b[7],16,-155497632),h=e(h,i,j,g,b[10],23,-1094730640),g=e(g,h,i,j,b[13],4,681279174),j=e(j,g,h,i,b[0],11,-358537222),i=e(i,j,g,h,b[3],16,-722521979),h=e(h,i,j,g,b[6],23,76029189),g=e(g,h,i,j,b[9],4,-640364487),j=e(j,g,h,i,b[12],11,-421815835),i=e(i,j,g,h,b[15],16,530742520),h=e(h,i,j,g,b[2],23,-995338651),g=f(g,h,i,j,b[0],6,-198630844),j=f(j,g,h,i,b[7],10,1126891415),i=f(i,j,g,h,b[14],15,-1416354905),h=f(h,i,j,g,b[5],21,-57434055),g=f(g,h,i,j,b[12],6,1700485571),j=f(j,g,h,i,b[3],10,-1894986606),i=f(i,j,g,h,b[10],15,-1051523),h=f(h,i,j,g,b[1],21,-2054922799),g=f(g,h,i,j,b[8],6,1873313359),j=f(j,g,h,i,b[15],10,-30611744),i=f(i,j,g,h,b[6],15,-1560198380),h=f(h,i,j,g,b[13],21,1309151649),g=f(g,h,i,j,b[4],6,-145523070),j=f(j,g,h,i,b[11],10,-1120210379),i=f(i,j,g,h,b[2],15,718787259),h=f(h,i,j,g,b[9],21,-343485551),a[0]=t(g,a[0]),a[1]=t(h,a[1]),a[2]=t(i,a[2]),a[3]=t(j,a[3])}function h(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a.charCodeAt(b)+(a.charCodeAt(b+1)<<8)+(a.charCodeAt(b+2)<<16)+(a.charCodeAt(b+3)<<24);return c}function i(a){var b,c=[];for(b=0;64>b;b+=4)c[b>>2]=a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24);return c}function j(a){var b,c,d,e,f,i,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;j>=b;b+=64)g(k,h(a.substring(b-64,b)));for(a=a.substring(b-64),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a.charCodeAt(b)<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(g(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),i=parseInt(e[1],16)||0,d[14]=f,d[15]=i,g(k,d),k}function k(a){var b,c,d,e,f,h,j=a.length,k=[1732584193,-271733879,-1732584194,271733878];for(b=64;j>=b;b+=64)g(k,i(a.subarray(b-64,b)));for(a=j>b-64?a.subarray(b-64):new Uint8Array(0),c=a.length,d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],b=0;c>b;b+=1)d[b>>2]|=a[b]<<(b%4<<3);if(d[b>>2]|=128<<(b%4<<3),b>55)for(g(k,d),b=0;16>b;b+=1)d[b]=0;return e=8*j,e=e.toString(16).match(/(.*?)(.{0,8})$/),f=parseInt(e[2],16),h=parseInt(e[1],16)||0,d[14]=f,d[15]=h,g(k,d),k}function l(a){var b,c=\"\";for(b=0;4>b;b+=1)c+=u[a>>8*b+4&15]+u[a>>8*b&15];return c}function m(a){var b;for(b=0;b<a.length;b+=1)a[b]=l(a[b]);return a.join(\"\")}function n(a){return/[\\u0080-\\uFFFF]/.test(a)&&(a=unescape(encodeURIComponent(a))),a}function o(a,b){var c,d=a.length,e=new ArrayBuffer(d),f=new Uint8Array(e);for(c=0;d>c;c+=1)f[c]=a.charCodeAt(c);return b?f:e}function p(a){return String.fromCharCode.apply(null,new Uint8Array(a))}function q(a,b,c){var d=new Uint8Array(a.byteLength+b.byteLength);return d.set(new Uint8Array(a)),d.set(new Uint8Array(b),a.byteLength),c?d:d.buffer}function r(a){var b,c=[],d=a.length;for(b=0;d-1>b;b+=2)c.push(parseInt(a.substr(b,2),16));return String.fromCharCode.apply(String,c)}function s(){this.reset()}var t=function(a,b){return a+b&4294967295},u=[\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\",\"a\",\"b\",\"c\",\"d\",\"e\",\"f\"];return\"5d41402abc4b2a76b9719d911017c592\"!==m(j(\"hello\"))&&(t=function(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}),\"undefined\"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function b(a,b){return a=0|a||0,0>a?Math.max(a+b,0):Math.min(a,b)}ArrayBuffer.prototype.slice=function(c,d){var e,f,g,h,i=this.byteLength,j=b(c,i),k=i;return d!==a&&(k=b(d,i)),j>k?new ArrayBuffer(0):(e=k-j,f=new ArrayBuffer(e),g=new Uint8Array(f),h=new Uint8Array(this,j,e),g.set(h),f)}}(),s.prototype.append=function(a){return this.appendBinary(n(a)),this},s.prototype.appendBinary=function(a){this._buff+=a,this._length+=a.length;var b,c=this._buff.length;for(b=64;c>=b;b+=64)g(this._hash,h(this._buff.substring(b-64,b)));return this._buff=this._buff.substring(b-64),this},s.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;e>b;b+=1)f[b>>2]|=d.charCodeAt(b)<<(b%4<<3);return this._finish(f,e),c=m(this._hash),a&&(c=r(c)),this.reset(),c},s.prototype.reset=function(){return this._buff=\"\",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},s.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},s.prototype.setState=function(a){return this._buff=a.buff,this._length=a.length,this._hash=a.hash,this},s.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},s.prototype._finish=function(a,b){var c,d,e,f=b;if(a[f>>2]|=128<<(f%4<<3),f>55)for(g(this._hash,a),f=0;16>f;f+=1)a[f]=0;c=8*this._length,c=c.toString(16).match(/(.*?)(.{0,8})$/),d=parseInt(c[2],16),e=parseInt(c[1],16)||0,a[14]=d,a[15]=e,g(this._hash,a)},s.hash=function(a,b){return s.hashBinary(n(a),b)},s.hashBinary=function(a,b){var c=j(a),d=m(c);return b?r(d):d},s.ArrayBuffer=function(){this.reset()},s.ArrayBuffer.prototype.append=function(a){var b,c=q(this._buff.buffer,a,!0),d=c.length;for(this._length+=a.byteLength,b=64;d>=b;b+=64)g(this._hash,i(c.subarray(b-64,b)));return this._buff=d>b-64?new Uint8Array(c.buffer.slice(b-64)):new Uint8Array(0),this},s.ArrayBuffer.prototype.end=function(a){var b,c,d=this._buff,e=d.length,f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(b=0;e>b;b+=1)f[b>>2]|=d[b]<<(b%4<<3);return this._finish(f,e),c=m(this._hash),a&&(c=r(c)),this.reset(),c},s.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},s.ArrayBuffer.prototype.getState=function(){var a=s.prototype.getState.call(this);return a.buff=p(a.buff),a},s.ArrayBuffer.prototype.setState=function(a){return a.buff=o(a.buff,!0),s.prototype.setState.call(this,a)},s.ArrayBuffer.prototype.destroy=s.prototype.destroy,s.ArrayBuffer.prototype._finish=s.prototype._finish,s.ArrayBuffer.hash=function(a,b){var c=k(new Uint8Array(a)),d=m(c);return b?r(d):d},s}),addEventListener(\"message\",function(a){function b(){var a=g*e,b=a+1024>=c.size?c.size:a+1024;i.readAsArrayBuffer(d.call(c,a,b))}var c=a.data,d=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,e=2097152,f=Math.ceil(c.size/e),g=0,h=new SparkMD5.ArrayBuffer,i=new FileReader;i.onload=function(a){h.append(a.target.result),g++,f>g?b():postMessage(h.end())},i.onerror=function(){postMessage(null)},b()},!1);';\nvar uriworker = 'addEventListener(\"message\",function(c){var a=c.data;var b=new FileReader();b.onload=function(d){postMessage(d.target.result)};b.readAsDataURL(a)},false);';\n\nvar file = function (filex, type) {\n    var _file = filex;\n    this._uri=\"\";\n    if ($.is.isString(filex)) {\n        if (type) {\n            _file = new Blob([filex], {type: type});\n        } else {\n            this._url=filex;\n            _file = file.getBlobFromURI(filex);\n        }\n    } else if ($.is.isArray(filex)) {\n        _file = new Blob(filex, {type: (type || \"text/plain\")});\n    }\n    this.file = _file;\n};\nfile.getBlobFromURI = function (dataURL) {\n    var BASE64_MARKER = ';base64,';\n    if (dataURL.indexOf(BASE64_MARKER) === -1) {\n        var parts = dataURL.split(',');\n        var contentType = parts[0].split(':')[1];\n        var raw = parts[1];\n        return new Blob([raw], {type: contentType});\n    }\n    var parts = dataURL.split(BASE64_MARKER);\n    var contentType = parts[0].split(':')[1];\n    var byteString = atob(parts[1]);\n    var ab = new ArrayBuffer(byteString.length);\n    var ia = new Uint8Array(ab);\n    for (var i = 0; i < byteString.length; i++) {\n        ia[i] = byteString.charCodeAt(i);\n    }\n    return new Blob([ab], {type: contentType});\n};\nfile.saveAs = function (blob, filename) {\n    var type = blob.type;\n    var force_saveable_type = 'application/octet-stream';\n    if (type && type !== force_saveable_type) {\n        var slice = blob.slice || blob.webkitSlice || blob.mozSlice;\n        blob = slice.call(blob, 0, blob.size, force_saveable_type);\n    }\n    var url = URL.createObjectURL(blob);\n    var event = document.createEvent(\"MouseEvent\");\n    event.initMouseEvent(\"click\", true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n    var t = document.createElement(\"a\");\n    t.href = url;\n    t.download = filename;\n    t.dispatchEvent(event);\n};\nfile.upload = function (option) {\n    return $.ajax({\n        url: option.url || null,\n        data: option.file,\n        method: \"post\",\n        dataType: \"json\",\n        timeout: option.timeout,\n        headers: option.headers || {},\n        query:option.query,\n        events: {\n            load: function (e) {\n                var status = e.target.status;\n                if ((status >= 200 && status < 300) || status === 304 || status === 0) {\n                    if (option.success) {\n                        var a = this.response.responseText;\n                        if (option.dataType === \"json\") {\n                            try {\n                                a = window.JSON.parse(a);\n                            } catch (e) {\n                                a = {};\n                            }\n                        }\n                        option.success(a);\n                    }\n                } else {\n                    if (option.error)\n                        option.error(e);\n                }\n            },\n            progress: function (e) {\n                if (option.progress) {\n                    option.progress({\n                        total: e.total,\n                        loaded: e.loaded,\n                        percent: Math.round(e.loaded * 100 / e.total)\n                    });\n                }\n            },\n            error: function (e) {\n                if (option.error)\n                    option.error(e);\n            }\n        }\n    });\n};\nfile.uploadAsForm = function (option) {\n    var formdata = new FormData();\n    formdata.append((option.name || \"file\"), option.file);\n    for (var _p in option.data) {\n        formdata.append(_p, option.data[_p]);\n    }\n    return $.ajax({\n        url: option.url || null,\n        data: formdata,\n        method: \"post\",\n        dataType: \"json\",\n        timeout: option.timeout,\n        query:option.query,\n        headers: option.headers || {},\n        events: {\n            load: function (e) {\n                var status = e.target.status;\n                if ((status >= 200 && status < 300) || status === 304 || status === 0) {\n                    if (option.success) {\n                        var a = this.response.responseText;\n                        if (option.dataType === \"json\") {\n                            try {\n                                a = window.JSON.parse(a);\n                            } catch (e) {\n                                a = {};\n                            }\n                        }\n                        option.success(a);\n                    }\n                } else {\n                    if (option.error)\n                        option.error(e);\n                }\n            },\n            progress: function (e) {\n                if (option.progress) {\n                    option.progress({\n                        total: e.total,\n                        loaded: e.loaded,\n                        percent: Math.round(e.loaded * 100 / e.total)\n                    });\n                }\n            },\n            error: function (e) {\n                if (option.error)\n                    option.error(e);\n            },\n            abort:function(){\n                if(option.abort){\n                    option.abort();\n                }\n            }\n        }\n    });\n};\nfile.prototype.isSame = function (file) {\n    var t = file;\n    if (file.file) {\n        t = file.getFile();\n    }\n    return this.file.lastModified === t.lastModified && this.file.size === t.size && this.file.type === t.type && this.file.name === t.name;\n};\nfile.prototype.getFile = function () {\n    return this.file;\n};\nfile.prototype.getFileName = function () {\n    return this.file ? this.file.name : \"\";\n};\nfile.prototype.getFileSize = function (type, size) {\n    var a = this.file.size;\n    if (type === \"MB\") {\n        a = this.file.size / (1024 * 1024);\n    } else if (type === \"KB\") {\n        a = this.file.size / 1024;\n    } else if (type === \"GB\") {\n        a = this.file.size / (1024 * 1024 * 1024);\n    }\n    if (arguments.length === 2) {\n        a = a.toFixed(size) / 1;\n    }\n    return a;\n};\nfile.prototype.getFileSizeAuto = function (radmon) {\n    var v = 0, unit = \"BYTE\", byteSize = this.file.size;\n    radmon = radmon || 0;\n    if (byteSize >= 1073741824) {\n        v = (byteSize / 1073741824).toFixed(radmon);\n        unit = \"GB\";\n    } else if (byteSize >= 1048576) {\n        v = (byteSize / 1048576).toFixed(radmon);\n        unit = \"MB\";\n    } else if (byteSize >= 1024) {\n        v = (byteSize / 1024).toFixed(radmon);\n        unit = \"KB\";\n    } else {\n        v = byteSize;\n        unit = \"B\";\n    }\n    return v + unit;\n};\nfile.prototype.getFileType = function () {\n    return this.file ? this.file.type : \"\";\n};\nfile.prototype.getFileURI = function () {\n    var ps = $.promise();\n    if(this._uri){\n        ps.resolve(this._uri);\n    }else{\n        var reader = new FileReader();\n        reader.onload = function (e) {\n            ps.resolve(e.target.result);\n        };\n        reader.readAsDataURL(this.file);\n    }\n    return ps;\n};\nfile.prototype.getFileURL = function () {\n    return window.URL.createObjectURL(this.file);\n};\nfile.prototype.getFileURIByWorker = function () {\n    var ps = $.promise();\n    var worker = new Worker(window.URL.createObjectURL(new Blob([uriworker], {type: \"text/javascript\"})));\n    worker.addEventListener(\"message\", function (e) {\n        ps.resolve(e.data);\n    });\n    worker.postMessage(this.file);\n    return ps;\n};\nfile.prototype.getFileHash = function () {\n    var ps = $.promise();\n    var worker = new Worker(window.URL.createObjectURL(new Blob([md5], {type: \"text/javascript\"})));\n    worker.addEventListener(\"message\", function (e) {\n        ps.resolve(e.data);\n    });\n    worker.postMessage(this.file);\n    return ps;\n};\nfile.prototype.getSuffix = function () {\n    if (this.getFileName()) {\n        var name = this.getFileName().split(\".\");\n        if (name.length > 1) {\n            return name[name.length - 1];\n        } else {\n            return \"\";\n        }\n    } else {\n        return \"\";\n    }\n};\nfile.prototype.isSuffixWith = function (suffix) {\n    return suffix === this.getSuffix();\n};\nfile.prototype.isTypeOf = function (type) {\n    var typet = this.getFileType();\n    return typet === type;\n};\nfile.prototype.createImageElement = function () {\n    var ps = $.promise();\n    if (this.file.type.indexOf(\"image\") !== -1) {\n        var image = document.createElement(\"img\");\n        var a=this.getFileURL();\n        $(image).load(function () {\n            ps.resolve({\n                uri: a,\n                element: image\n            });\n        });\n        image.src = a;\n    } else {\n        ps.reject();\n    }\n    return ps;\n};\nfile.prototype.compressImage = function (quality) {\n    var ps = $.promise(), ths = this;\n    this.createImageElement().then(function (a) {\n        var cvs = document.createElement('canvas');\n        cvs.width = a.width;\n        cvs.height = a.height;\n        cvs.getContext(\"2d\").drawImage(a, 0, 0);\n        ps.resolve(new file(cvs.toDataURL(ths.file.type, quality / 100)));\n    },function () {\n        ps.reject();\n    });\n    return ps;\n};\nfile.prototype.createImageCanvas = function (width, height) {\n    var ps = promise();\n    if (this.file.type.indexOf(\"image\") !== -1) {\n        var a=this.getFileURL();\n        var image = document.createElement(\"img\");\n        $(image).load(function () {\n            try {\n                var _width = image.width, _height = image.height;\n                var _w = 0, _h = 0;\n                if (_width > width) {\n                    _w = width;\n                    _h = _height / _width * width;\n                    if (_h > height) {\n                        _h = height;\n                        _w = _width / _height * height;\n                    }\n                } else if (_height > height) {\n                    _h = height;\n                    _w = _width / _height * height;\n                    if (_w > width) {\n                        _w = width;\n                        _h = _height / _width * width;\n                    }\n                } else {\n                    _w = image.width;\n                    _h = image.height;\n                }\n                var _x = (width - _w) / 2, _y = (height - _h) / 2;\n                var source = image;\n                if (image.width > 8000 || image.height > 8000) {\n                    var cvs = document.createElement('canvas');\n                    cvs.width = image.width;\n                    cvs.height = image.height;\n                    var ctx=cvs.getContext(\"2d\");\n                    ctx.mozImageSmoothingEnabled = false;\n                    ctx.webkitImageSmoothingEnabled = false;\n                    ctx.msImageSmoothingEnabled = false;\n                    ctx.imageSmoothingEnabled = false;\n                    ctx.mozImageSmoothingQuality = \"low\";\n                    ctx.webkitImageSmoothingQuality = \"low\";\n                    ctx.msImageSmoothingQuality = \"low\";\n                    ctx.imageSmoothingQuality = \"low\";\n                    ctx.drawImage(image, 0, 0);\n                    source = cvs;\n                }\n                var cvs2 = document.createElement('canvas');\n                cvs2.width = width;\n                cvs2.height = height;\n                var ctx=cvs2.getContext(\"2d\");\n                ctx.mozImageSmoothingEnabled = false;\n                ctx.webkitImageSmoothingEnabled = false;\n                ctx.msImageSmoothingEnabled = false;\n                ctx.imageSmoothingEnabled = false;\n                ctx.mozImageSmoothingQuality = \"low\";\n                ctx.webkitImageSmoothingQuality = \"low\";\n                ctx.msImageSmoothingQuality = \"low\";\n                ctx.imageSmoothingQuality = \"low\";\n                ctx.drawImage(source, 0, 0, image.width, image.height, _x, _y, _w, _h);\n                ps.resolve({\n                    uri: a,\n                    element: cvs2\n                });\n            }catch (e){\n                console.log(e);\n                ps.reject({\n                    uri:a,\n                    element:null\n                });\n            }\n        }).error(function (a) {\n            ps.reject({\n                uri:a,\n                element:null\n            });\n        });\n        image.src = a;\n    } else {\n        ps.reject();\n    }\n    return ps;\n};\nfile.prototype.saveAs = function (filename) {\n    file.saveAs(this.file, filename);\n};\nfile.prototype.upload = function (option) {\n    option.file = this.file;\n    return file.upload(option);\n};\nfile.prototype.uploadAsForm = function (option) {\n    option.file = this.file;\n    return file.uploadAsForm(option);\n};\nfile.prototype.getChunk = function (from, size, mime) {\n    var blob = this.file;\n    var slice = blob.slice || blob.webkitSlice || blob.mozSlice;\n    var args = [from];\n    if (arguments.length === 2) {\n        if ($.is.isString(mime)) {\n            args.push(size);\n        } else {\n            args.push(from + size);\n        }\n    } else if (arguments.length === 3) {\n        args.push(from + size);\n        args.push(mime);\n    }\n    return slice.apply(blob, args);\n};\nfile.prototype.uploadChunk = function (option) {\n    var from = option.from, size = option.size, mime = option.mime;\n    var args = [];\n    if (from !== undefined && from !== null) {\n        args.push(from);\n    }\n    if (size !== undefined && size !== null) {\n        args.push(size);\n    }\n    if (mime !== undefined && mime !== null) {\n        args.push(mime);\n    }\n    option.file = this.getChunk.apply(this, args);\n    return file.upload(option);\n};\nfile.prototype.getChunks = function (from, size, mime) {\n    var ths = this;\n    var blob = this.file;\n    var slice = blob.slice || blob.webkitSlice || blob.mozSlice;\n    var sizet = ths.getFileSize();\n    var q = parseInt((sizet - from) / size);\n    var r = [];\n    for (var i = 0; i < q; i++) {\n        var args = [from + i * size, from + (i + 1) * size, mime];\n        r.push(slice.apply(blob, args));\n    }\n    r.push(slice.apply(blob, [from + q * size, sizet, mime]));\n    return r;\n};\nfile.prototype.uploadChunks = function (ops) {\n    return this.uploadChunksByPool($.extend(ops,{poolsize:1}));\n};\n\nmodule.exports = function (filet,type) {\n    return new file(filet,type);\n};"}],"css":[{"p":"util.style.images","h":"80c5adaef4","c":".imagesuploader {\n  padding: 20px 0 20px 0;\n  position: relative; }\n  .imagesuploader .imagesuploader-label {\n    line-height: 35px; }\n  .imagesuploader .imagesuploader-container {\n    position: relative;\n    background: white;\n    border: 1px solid #D7D7D7;\n    border-radius: 5px;\n    overflow: hidden; }\n    .imagesuploader .imagesuploader-container .imagesuploader-image {\n      position: absolute;\n      left: 0;\n      top: 0;\n      right: 0;\n      bottom: 0; }\n      .imagesuploader .imagesuploader-container .imagesuploader-image .imagesuploader-image-bg {\n        position: absolute;\n        left: 0;\n        top: 0;\n        right: 0;\n        bottom: 0;\n        background-repeat: no-repeat;\n        background-position: center;\n        background-size: contain; }\n      .imagesuploader .imagesuploader-container .imagesuploader-image .imageuploader-progress {\n        position: absolute;\n        left: 0;\n        bottom: 0;\n        height: 35px;\n        background: #A0C4D2; }\n      .imagesuploader .imagesuploader-container .imagesuploader-image .imagesuploader-image-tip {\n        line-height: 30px;\n        width: 100px;\n        text-align: center;\n        position: absolute;\n        left: 50%;\n        top: 50%;\n        margin-left: -50px;\n        margin-top: -15px; }\n    .imagesuploader .imagesuploader-container .imagesuploader-filebtnplus {\n      position: absolute;\n      left: 0;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      width: 100%;\n      height: 100%; }\n      .imagesuploader .imagesuploader-container .imagesuploader-filebtnplus input {\n        display: block;\n        width: 100%;\n        height: 100%;\n        position: absolute;\n        left: 0;\n        top: 0;\n        right: 0;\n        bottom: 0;\n        opacity: 0; }\n"}],"template":[{"p":"util.template.imagestemp","h":"7a615cee41","c":"<!--[imagesuploader]--><div class=\"imagesuploader-label\"><%=data.label;%></div><div class='imagesuploader-container' style=\"height:<%=data.height;%>\"><div class='imagesuploader-image'><%if(data.image){%><div class='imagesuploader-image-bg' style=\"background-image:url(<%=data.image;%>)\"></div><div class='imageuploader-progress'></div><%}%></div><div class=\"imagesuploader-image\"><div class=\"imagesuploader-image-tip\">select images</div></div><div class='imagesuploader-filebtnplus'><div class='imagesuploader-addicon'></div><input multiple='multiple' type='file' data-bind='change:file' accept='image/gif,image/jpeg,image/jpg,image/png,image/bmp'/></div></div>"},{"p":"site.template.admintemp","h":"e448f711f2","c":"<!--[login]--><div class=\"login-con\"><div class=\"login-con-logo\"><div class=\"login-con-logo-in\"><img src=\"site/style/images/logo.png\"/></div></div><div class=\"login-con-in\"><div class=\"login-con-input\"><div class=\"logo-con-input-label\">username</div><input type=\"text\" placeholder=\"username\" data-find=\"username\"></div><div class=\"login-con-input\"><div class=\"logo-con-input-label\">password</div><input type=\"password\" placeholder=\"password\" data-find=\"password\"></div><div class=\"login-con-btn\" data-find=\"submit\">login</div></div></div><!--[adminhead]--><div class=\"adminhead-nav\"><div class=\"adminhead-nav-con\"><a href=\"admin/userinfo\" class=\"adminhead-nav-item\">userinfo</a><a href=\"#\" class=\"adminhead-nav-item\">Setting</a></div></div><!--[articlelist]--><div class=\"articlelist-head\"><div class=\"atticlelist-head-btn\" data-bind=\"click:add\" href=\"admin/addarticle\"><i class=\"fa fa-circle-plus\"></i> Add Article</div></div><div class=\"articlelist-list\" data-find=\"con\"><%for(var i in data){%><div class=\"list-con\" data-group=\"item\" @cache(data[i])><div class=\"list-con-title\"><a href=\"admin/editarticle?id=<%=data[i].id;%>\" data-groupi=\"title\"><%=data[i].title;%></a></div><div class=\"list-con-desc\"><%=data[i].descs||\"no description\";%></div><div class=\"list-con-time\">16 05 12</div><div class=\"list-con-remove\" data-groupi=\"remove\"><i class=\"fa fa-circle-cross\"></i></div></div><%}%></div><div class=\"list-loading\" data-find=\"loading\"><div class=\"list-loading-icon\"><i class=\"fa fa-loader fa-spin\"></i></div></div><!--[editarticle]--><div class=\"editarticle-con\"><div class=\"editarticle-con-title\">Edit Article</div><div class=\"editarticle-con-image\"><@module type=\"{{option.imageType}}\"/></div><div class=\"editarticle-con-label\">Title</div><div class=\"editarticle-con-input\" data-group=\"title\"><input type=\"text\" placeholder=\"title\" data-groupi=\"input\" name=\"title\" value=\"<%=data.title;%>\"/></div><div class=\"editarticle-con-label\">Short Desc</div><div class=\"editarticle-con-input\" data-group=\"desc\"><textarea type=\"text\" placeholder=\"title\" data-groupi=\"input\" name=\"desc\" style=\"height:100px;\"><%=data.desc;%></textarea></div><div class=\"editarticle-con-label\">Content</div><div class=\"editarticle-con-content\" data-find=\"editor\"></div><div class=\"editarticle-con-btn\"><div class=\"editarticle-con-btn-submit\" data-find=\"submit\">Submit</div></div></div><!--[edituserinfo]--><div class=\"editarticle-con\"><div class=\"editarticle-con-title\">Edit User Info</div><div class=\"editarticle-con-label\">Content</div><div class=\"editarticle-con-content\" data-find=\"editor\"></div><div class=\"editarticle-con-btn\"><div class=\"editarticle-con-btn-submit\" data-find=\"submit\">Submit</div></div></div><!--[noadminhead]--><div class=\"adminhead-nav\"></div><!--[copyright]--><div class=\"copyright\">©2016 • All rights reserved.</div>"}]});