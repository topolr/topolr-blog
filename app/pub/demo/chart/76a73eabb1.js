/*!
 * @packet demo.chart.chart;
 * @require demo.chart.dombuilder;
 * @require demo.chart.graph;
 * @css demo.chart.style.chart;
 */
-1!==$.browser.name().indexOf("msie")&&$.override("msiesvg",{addClass:function(t){if(!this.isEmpty())if(this.nodes[0].className.baseVal)for(var a in this.nodes)this.nodes[a].className.baseVal&&-1===this.nodes[a].className.baseVal.indexOf(t)&&(this.nodes[a].className.animVal=this.nodes[a].className.baseVal=this.nodes[a].className.baseVal+" "+t);else this.predefined("addClass",t);return this},removeClass:function(t){if(!this.isEmpty())if(this.nodes[0].className.baseVal){if(-1!==this.nodes[0].className.baseVal.indexOf(t)){var a=new RegExp("(\\s|^)"+t+"(\\s|$)");for(var e in this.nodes)this.nodes[e].className.animVal=this.nodes[e].className.baseVal=this.nodes[e].className.baseVal.replace(a," ")}}else this.predefined("removeClass",t);return this},hasClass:function(t){var a=!1;return this.isEmpty()||(this.nodes[0].className.baseVal?a=-1===this.nodes[0].className.baseVal.indexOf(t):this.predefined("hasClass",t)),a},toggleClass:function(t){if(!this.isEmpty())if(this.nodes[0].className.baseVal)if(-1!==this.nodes[0].className.baseVal.indexOf(t)){var a=new RegExp("(\\s|^)"+t+"(\\s|$)");for(var e in this.nodes)this.nodes[e].className.animVal=this.nodes[e].className.baseVal=this.nodes[e].className.baseVal.replace(a," ")}else for(var e in this.nodes)this.nodes[e].className.animVal=this.nodes[e].className.baseVal=this.nodes[e].className.baseVal+" "+t;else this.predefined("toggleClass",t);return this},children:function(t){var a=[];this.isEmpty()||(a=$.is.isString(t)?dom.util.queryChild(this.nodes[0],t):1===arguments.length&&t>=0?[this.nodes[0].children[t]]||[]:Array.prototype.slice.call(this.nodes[0].children||this.nodes[0].childNodes));var e=$();return e.nodes=a,e.length=a.length,e}});var factory=$.adapt();factory.def({name:"baseChart",draw:function(){}}),factory.def({name:"baseInfo",init:function(t){for(var a in t)this[a]=t[a]}}),factory.def({name:"axisInfo",extend:"baseInfo",option:{x:0,y:0,width:100,height:100,xper:20,yper:20,xoffset:10,yoffset:10,xstep:5,ystep:5,xis:100,yis:100}}),factory.def({name:"pieInfo",extend:"baseInfo",option:{x:0,y:0,width:100,height:100,point:[50,50],r:50,start:[0,0]}}),factory.def({name:"graph",extend:"baseChart"}),factory.def({name:"board",extend:"baseChart",option:{},init:function(){console.log(this),this.children=[]},addChild:function(t){return t&&t.typeOf&&t.typeOf("baseChart")&&(t.baseInfo=this.baseInfo,t.parent=this,this.children.push(t)),this},getChildByType:function(t){for(var a=[],e=0;e<this.children.length;e++)this.children[e].type()===t&&a.push(this.children[e]);return a},each:function(t){for(var a=0;a<this.children.length;a++)t&&t.call(this.children[a],a)}}),factory.def({name:"axisBoard",extend:"board",option:{padding:null,xAxis:null,yAxis:[]},init:function(t){this.xMainAxis=t.xAxis,this.yMainAxis=t.yAxis;var a=t.dom.width()-t.padding.left-t.padding.right,e=t.dom.height()-t.padding.top-t.padding.bottom,i=a/(this.xMainAxis.to-this.xMainAxis.from),s=e/(this.yMainAxis.to-this.yMainAxis.from),n=factory.create("axisInfo",{x:t.padding.left,y:t.padding.top,width:a,height:e,xper:i,yper:s,xoffset:(this.xMainAxis.to-this.xMainAxis.from)/this.xMainAxis.step*i,yoffset:(this.yMainAxis.to-this.yMainAxis.from)/this.yMainAxis.step*s,xstep:this.xMainAxis.step,ystep:this.yMainAxis.step,xis:(0-this.xMainAxis.from)*i,yis:(0-this.yMainAxis.from)*s});this.baseInfo=n;var r=$("<div class='tip'></div>").appendTo(t.dom).hide(),d=null;t.dom.bind("currentselect",function(t){d=t.data,t.stopPropagation()}).bind("mousemove",function(t){var a=t.offsetX,e=t.offsetY;a>=n.x-10&&a<=n.x+n.width&&e>=n.y-10&&e<=n.y+n.height?d&&d.find("circle").each(function(){var t=$(this).get(0).getBBox().x,e=$(this).get(0).getBBox().y;return a>=t-4&&t+4>=a?(r.html("xxxxxxx").css({left:t-r.width()/2+2.5+"px",top:e-r.height()-5+"px"}).show(),!1):void 0}):r.hide()})},draw:function(){var t=$.svgbuilder("g");t.append(this.getChildByType("title")[0].draw()),t.append(this.getChildByType("grid")[0].draw());var a=t.append("g",{"class":"axis"});a.append(this.getChildByType("xaxis")[0].draw());for(var e=this.getChildByType("yaxis"),i=0;i<e.length;i++)a.append(e[i].draw());a.append(this.getChildByType("xyaxis")[0].draw());var s=t.append("g",{"class":"graphs"}),n=this;["bar","multibar","area","line"].forEach(function(t){for(var a=n.getChildByType(t),e=0;e<a.length;e++)s.append(a[e].draw())}),t.append(this.getChildByType("legend")[0].draw()),t.appendTo(this.option.dom)}}),factory.def({name:"pieBoard",extend:"board",option:{r:100,left:100,top:100},init:function(t){this.baseInfo=factory.create("pieInfo",{x:t.left,y:t.top,width:t.dom.width(),height:t.dom.height(),point:[t.left+t.r,t.top+t.r],r:t.r,start:[t.left+2*t.r,t.top+t.r]})},draw:function(){var t=$.svgbuilder("g",{"class":"pie"}),a=this.getChildByType("title")[0],e=$.extend({},a.baseInfo);e.x=0,a.baseInfo=e,t.append(a.draw());for(var i=this.getChildByType("pie"),s=0;s<i.length;s++)t.append(i[s].draw());t.append(this.getChildByType("pielabel")[0].draw()),t.append(this.getChildByType("legend")[0].draw()),t.appendTo(this.option.dom)}}),factory.def({name:"pie",extend:"graph",option:{isclick:!0,rotate:10,finalRotate:10,color:"yellow",label:"",name:"",start:[],end:[],globalStart:[]},draw:function(){var t,a=this.option,e=this.baseInfo;t=a.rotate>180?$.d().add("M",a.start).add("A",[e.r,e.r,0,1,1,a.end[0],a.end[1]]).add("L",e.point).add("z",[]):$.d().add("M",a.start).add("A",[e.r,e.r,0,0,1,a.end[0],a.end[1]]).add("L",e.point).add("z",[]);var i=$.svgbuilder("g",{"class":"pie "+a.color,id:a.id});i.append("path",{"class":"circle",d:t.stringify()});var s=a.finalRotate-a.rotate/2,n=[a.globalStart[0]+5,a.globalStart[1]],r=this.getRotatePoint(e.point,n,s);n=[a.globalStart[0]+25,a.globalStart[1]];var d=this.getRotatePoint(e.point,n,s),o=$.d().add("M",r).add("L",d).add("L",[d[0],d[1]+10]);return i.append("path",{"class":"piclabel",d:o.stringify()}),o=$.d().add("M",[d[0],d[1]-10]).add("L",[d[0],d[1]+10]),i.append("path",{"class":"piclabel",d:o.stringify()}),d[0]<r[0]?i.append("text",{x:d[0]-4,y:d[1]+5}).html(a.value).css({"text-anchor":"end"}):i.append("text",{x:d[0]+4,y:d[1]+5}).html(a.value),a.isclick&&i.bind("click",function(){if($(this).hasClass("moveout"))$(this).css({transform:"translate(0,0)"}).removeClass("moveout");else{var t=a.finalRotate-a.rotate/2-90,e=8*Math.sin(t/180*Math.PI),i=8*Math.cos(t/180*Math.PI);$(this).css({transform:"translate("+-e+"px,"+i+"px)"}).addClass("moveout")}}),i},getRotatePoint:function(t,a,e){var i=(a[0]-t[0])*Math.cos(e/180*Math.PI)-(a[1]-t[1])*Math.sin(e/180*Math.PI)+t[0],s=(a[1]-t[1])*Math.cos(e/180*Math.PI)+(a[0]-t[0])*Math.sin(e/180*Math.PI)+t[1];return[i,s]}}),factory.def({name:"pielabel",extend:"graph",option:{r:80,color:"white",title:[]},draw:function(){var t=this.option,a=this.baseInfo,e=$.svgbuilder("g",{"class":"pielabel"});e.append("circle",{cx:a.x+a.r,cy:a.y+a.r,r:t.r}).css({fill:t.color});for(var i=0,s=0;s<t.title.length;s++)i+=t.title[s].lineHeight||20;for(var n=a.y+(2*a.r-i)/2,s=0;s<t.title.length;s++)n+=t.title[s].lineHeight||20,e.append("text",{x:a.x+a.r,y:n},{color:t.title[s].color||"black","font-size":(t.title[s].fontSize||"12")+"px"}).html(t.title[s].text);return e}}),factory.def({name:"grid",extend:"graph",option:{type:"all"},draw:function(){var t=this.option,a=this.baseInfo,e=$.svgbuilder("g",{"class":"grid"});if("all"===t.type||"y"===t.type)for(var i=0;i<=a.xstep;i++){var s=a.x+i*a.xoffset,n=$.d().add("M",[s,a.y]).add("L",[s,a.y+a.height]);e.append("path",{d:n.stringify()})}if("all"===t.type||"x"===t.type)for(var i=0;i<=a.ystep;i++){var s=a.y+i*a.yoffset,n=$.d().add("M",[a.x,s]).add("L",[a.x+a.width,s]);e.append("path",{d:n.stringify()})}return e}}),factory.def({name:"xyaxis",extend:"graph",draw:function(){var t=this.baseInfo,a=$.svgbuilder("g",{"class":"xyaxis"}),e=$.d().add("M",[t.x-3,t.y+t.height-t.yis]).add("L",[t.x+t.width+3,t.y+t.height-t.yis]);return a.append("path",{d:e.stringify()}),e=$.d().add("M",[t.x+t.xis,t.y]).add("L",[t.x+t.xis,t.y+t.height+3]),a.append("path",{d:e.stringify()}),a}}),factory.def({name:"title",extend:"graph",option:{data:null},draw:function(){for(var t=this.option,a=this.baseInfo,e=$.svgbuilder("g",{"class":"title"}),i=10,s=0;s<t.data.length;s++)i+=t.data[s].lineHeight||20,e.append("text",{x:a.x+a.width/2,y:i},{color:t.data[s].color||"black","font-size":(t.data[s].fontSize||"12")+"px"}).html(t.data[s].text);return e}}),factory.def({name:"xaxis",extend:"graph",option:{from:0,to:100,step:10,label:[],title:"",isnumber:!1},draw:function(){var t=$.svgbuilder("g",{"class":"axis-x"}),a=this.option,e=this.baseInfo,i=e.width/a.step,s=e.y+e.height,n=$.d().add("M",[e.x,e.y+e.height]).add("",[e.x+e.width,s]);t.append("path",{d:n.stringify()});for(var r=(a.to-a.from)/a.step,d=0;d<=a.step;d++){var o=e.x+d*i,n=$.d().add("M",[o,s+3]).add("L",[o,s]);t.append("path",{d:n.stringify()}),a.isnumber&&t.append("text",{x:o,y:s+20,"class":"number"}).html(a.from+d*r+a.unit),a.islabel&&d!==a.step&&t.append("text",{x:o+i/2,y:s+20,"class":"label"}).html(a.label[d]||"")}return a.title&&""!==a.title&&t.append("text",{x:e.x+e.width/2,y:s+40,"class":"title"}).html(a.title),t}}),factory.def({name:"yaxis",extend:"graph",option:{from:0,to:100,step:10,label:[],title:"",isnumber:!1},draw:function(){var t=-8,a=-3,e=-40,i=null,s=this.option,n=this.baseInfo,r=n.x,d=n.y;"right"===s.position?(i=$.svgbuilder("g",{"class":"axis-y right"}),t=8,a=3,e=40,r=n.x+n.width):i=$.svgbuilder("g",{"class":"axis-y"});var o=$.d().add("M",[r,d]).add("",[r,d+n.height]),h=n.height/s.step,l=(s.to-s.from)/s.step;i.append("path",{d:o.stringify()});for(var p=0;p<=s.step;p++){var f=d+p*h,o=$.d().add("M",[r+a,f]).add("L",[r,f]);i.append("path",{d:o.stringify()}),s.isnumber&&i.append("text",{x:r+t,y:f+5,"class":"number"}).html(s.from+(s.step-p)*l+s.unit),s.islabel&&p!==s.step&&i.append("text",{x:r+t,y:n.y+20,"class":"label"}).html(s.label[p])}return s.title&&""!==s.title&&i.append("text",{x:r+e,y:d+n.height/2,"class":"title"}).html(s.title),i.future(function(){var t=0;if($(this).hasClass("right")){for(var a=$(this).prev();a&&a.length>0&&(!a.hasClass("axis-y")||!a.hasClass("right"));)a=a.prev();a&&a.length>0&&(t=a.get(0).getBBox().width+10)}else{for(var a=$(this).prev();a&&a.length>0&&(!a.hasClass("axis-y")||a.hasClass("right"));)a=a.prev();a&&a.length>0&&(t=-a.get(0).getBBox().width-10)}$(this).css("transform","translate("+t+"px,0)")}),i}}),factory.def({name:"bar",extend:"graph",option:{width:15,color:"info",marginLeft:0,marginRight:0,flip:!1,data:null},init:function(t){},draw:function(){var t=this.option,a=t.data,e=this.baseInfo,i=$.svgbuilder("g",{"class":"bar "+t.color,id:t.id||""});if(t.flip)for(var s=0;s<e.xstep;s++){var n=e.height+e.y-s*e.yoffset-t.width-(e.yoffset-t.width)/2,r=a[s]*e.xper;r>0?i.append("rect",{x:e.x+e.xis,y:n+t.marginRight-t.marginLeft,width:r,height:t.width}):i.append("rect",{x:e.x+e.xis-Math.abs(r),y:n+t.marginRight-t.marginLeft,width:Math.abs(r),height:t.width})}else for(var s=0;s<e.xstep;s++){var n=e.x+s*e.xoffset+(e.xoffset-t.width)/2,r=a[s]*e.yper;r>0?i.append("rect",{x:n+t.marginRight-t.marginLeft,y:e.y-r-e.yis+e.height,width:t.width,height:r}):i.append("rect",{x:n+t.marginRight-t.marginLeft,y:e.y-e.yis+e.height,width:t.width,height:Math.abs(r)})}return i}}),factory.def({name:"multibar",extend:"graph",option:{width:15,color:"info",marginLeft:0,marginRight:0,flip:!1,data:null},draw:function(){var t=this.option,a=t.data,e=this.baseInfo,i=$.svgbuilder("g",{"class":"bar",id:t.id||""});if(t.flip)for(var s=0;s<e.xstep;s++)for(var n=e.y-s*e.yoffset-t.width-(e.yoffset-t.width)/2,r=0,d=0,o=0;o<a.length;o++){var h=a[o].data[s],l=h*e.xper;h>0?(i.append("rect",{x:t.x+r+e.xis,y:n+t.marginRight-t.marginLeft,width:l,height:t.width,"class":a[o].color}),r+=l):(d+=Math.abs(l),i.append("rect",{x:t.x+e.xis-d,y:n+t.marginRight-t.marginLeft,width:Math.abs(l),height:t.width,"class":a[o].color}))}else for(var s=0;s<e.xstep;s++)for(var n=e.x+s*e.xoffset+(e.xoffset-t.width)/2,r=0,d=0,o=0;o<a.length;o++){var h=a[o].data[s],l=h*e.yper;h>0?(r+=l,i.append("rect",{x:n+t.marginRight-t.marginLeft,y:e.y-r-e.yis+e.height,width:t.width,height:l,"class":a[o].color})):(i.append("rect",{x:n+t.marginRight-t.marginLeft,y:e.y-e.yis+d+e.height,width:t.width,height:Math.abs(l),"class":a[o].color}),d+=Math.abs(l))}return i}}),factory.def({name:"line",extend:"graph",option:{color:"info",data:null},draw:function(){for(var t=this.option,a=this.baseInfo,e=$.svgbuilder("g",{"class":"line "+t.color,id:t.id}),i=$.d(),s=[],n=0;n<t.data.length;n++){var r=a.xis+a.x+t.data[n][0]*a.xper,d=a.y+a.height-t.data[n][1]*a.yper-a.yis;0===n?i.add("M",[r,d]):i.add("",[r,d]),s.push({cx:r,cy:d,r:5})}e.append("path",{d:i.stringify()});for(var n=0;n<s.length;n++)e.append("circle",s[n]);return e.bind("mousemove",function(){$(this).trigger("currentselect",$(this))}),e}}),factory.def({name:"area",extend:"graph",option:{color:"info",data:null},draw:function(){for(var t=this.option,a=this.baseInfo,e=$.svgbuilder("g",{"class":"area "+t.color,id:t.id}),i=$.d(),s=[],n=null,r=null,d=0;d<t.data.length;d++){var o=a.xis+a.x+t.data[d][0]*a.xper,h=a.y+a.height-t.data[d][1]*a.yper-a.yis;0===d?(n=[o,h],i.add("M",[o,h])):(i.add("L",[o,h]),d===t.data.length-1&&(r=[o,h])),s.push({cx:o,cy:h,r:3})}i.add("L",[r[0],a.y+a.height]).add("L",[n[0],a.y+a.height]).add("z",[]),e.append("path",{d:i.stringify()});for(var d=0;d<s.length;d++)e.append("circle",s[d]);return e.bind("mousemove",function(){$(this).trigger("currentselect",$(this))}),e}}),factory.def({name:"legend",extend:"graph",option:{direction:"h",position:"r-m",lineHeight:15,data:null},draw:function(){for(var t=this.option,a=(this.baseInfo,$.svgbuilder("g",{"class":"legendpart",ts:t.position})),e=20,i=1,s=0;s<t.data.length;s++){var n=a.append("g",{"class":"legend "+t.data[s].color,lid:t.data[s].id||""}).bind("click",function(){$.toggle("msiesvg"),$(this).toggleClass("disabled");var t=$(this).attr("lid");$(this).hasClass("disabled")?$(this).parent(".chart").find("#"+t).hide():$(this).parent(".chart").find("#"+t).show(),$.toggle()}).bind("mouseover",function(){var t=$(this).attr("lid");$.toggle("msiesvg"),$(this).parent(".chart").find("#"+t).addClass("hover"),$.toggle()}).bind("mouseout",function(){var t=$(this).attr("lid");$.toggle("msiesvg"),$(this).parent(".chart").find("#"+t).removeClass("hover"),$.toggle()});n.append("rect",{x:1,y:i,width:10,height:8}),n.append("text",{x:13,y:i+7}).html(t.data[s].name||""),"h"===t.direction?(i+=e,a.future(function(){var t=0,a=0;$(this).children().each(function(){var i=$(this).get(0).getBBox();t+=e,i.width>a&&(a=i.width)});var i=$(this).attr("ts"),s=i.split("-"),n=s[0],r=s[1],d=0,o=0,h=$(this).parent(".chart").width(),l=$(this).parent(".chart").height();o="t"===n?5:"m"===n?l/2-t/2:l-t-5,d="l"===r?5:"m"===r?h/2-a/2:h-a-5,$(this).attr({transform:"translate("+d+","+o+")"})})):a.future(function(){var t=0;$(this).children().each(function(){$(this).css({transform:"translate("+t+"px,0)"}),t+=$(this).get(0).getBBox().width+10});var a=t-10,e=$(this).get(0).getBBox().height,i=$(this).attr("ts"),s=i.split("-"),n=s[0],r=s[1],d=0,o=0,h=$(this).parent(".chart").width(),l=$(this).parent(".chart").height();o="t"===n?5:"m"===n?l/2-e/2:l-e-5,d="l"===r?5:"m"===r?h/2-a/2:h-a-5,$(this).attr({transform:"translate("+d+","+o+")"})})}return a.data("chart",this),a}}),$.fn.axisChart=function(t){$.toggle("msiesvg"),$(this).addClass("chart");var a=factory.create("axisBoard",{dom:$(this),padding:t.padding,xAxis:t.xAxis,yAxis:t.yAxis[0]});a.addChild(factory.create("title",{data:t.title})),a.addChild(factory.create("grid",t.grid)),a.addChild(factory.create("xyaxis")),a.addChild(factory.create("xaxis",t.xAxis));for(var e=0;e<t.yAxis.length;e++)a.addChild(factory.create("yaxis",t.yAxis[e]));var i=[];for(var e in t.graph)if(factory.has(e)){var s=t.graph[e];for(var n in s){var r=factory.create(e,s[n]);a.addChild(r),r.option.id=e+"-"+n,r.option.name||(r.option.name=e+"-"+n),r.option.color||(r.option.color="info"),i.push({id:r.option.id,name:r.option.name,color:r.option.color})}}t.legend.data=i,a.addChild(factory.create("legend",t.legend)),a.draw(),$.toggle()},$.fn.pieChart=function(t){$.toggle("msiesvg"),$(this).addClass("chart");var a=$.extend({left:100,top:50,r:100,dom:$(this)},t),e=factory.create("pieBoard",a),i=e.baseInfo.start,s=e.baseInfo.point,n=0;e.addChild(factory.create("title",{data:t.title})),e.addChild(factory.create("pielabel",t.pielabel));for(var r=[],d=0,o=0;o<t.data.length;o++)d+=t.data[o].value;for(var o=0;o<t.data.length;o++)t.data[o].rotate=t.data[o].value/d*360;for(var o=0;o<t.data.length;o++){var h=factory.create("pie",t.data[o]),l=t.data[o].rotate;n+=l,h.option.start=i,h.option.finalRotate=n,h.option.globalStart=e.baseInfo.start;var p=(i[0]-s[0])*Math.cos(l/180*Math.PI)-(i[1]-s[1])*Math.sin(l/180*Math.PI)+s[0],f=(i[1]-s[1])*Math.cos(l/180*Math.PI)+(i[0]-s[0])*Math.sin(l/180*Math.PI)+s[1];h.option.end=[p,f],i=[p,f],e.addChild(h),h.option.id="pie-"+o,h.option.name||(h.option.name="pie-"+o),h.option.color||(h.option.color="info"),r.push({id:h.option.id,name:h.option.name,color:h.option.color})}t.legend.data=r,e.addChild(factory.create("legend",t.legend)),e.draw(),$.toggle()};