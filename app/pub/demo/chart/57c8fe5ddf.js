/*!
 * @packet demo.chart.dombuilder;
 */
$.builder=function(e,t,n,r){return new element(e,t,n,r)},$.svgbuilder=function(e,t,n,r){0===arguments.length&&(e="g");var i=new element(e,t,n,r);return i._issvg=!0,i};var element=function(e,t,n,r){this._tag=(e||"").toLowerCase(),this._class=[],this._dataset={},this._props=t||{},this._css=n||{},this._children=[],this._event=null,this._data=null,this._parent=null,this._future=null,this._text="",this._issvg=!1,t&&t["class"]&&(this._class.push(t["class"]),t["class"]=null);for(var i in r)this._dataset[element._uper(i)]=r[i]};element._compile=function(e){var t=[],n=[],r=[],i="",s=[],l=function(i){var h=" ",a="",p="",_=" style='",u=" class='",o="",c=!1,d=!1,f=!1;if(i._event&&(t.push(i._event),i._event=null,h+=" event='"+(t.length-1)+"'",f=!0),i._data&&(n.push(i._data),i._data=null,h+=" cache='"+(n.length-1)+"'",f=!0),i._future&&(r.push(i._future),i._future=null,h+=" future='"+(r.length-1)+"'",f=!0),f)if(e===!0)if(i._props.id)s.push(i._props.id);else{var m="___todo"+Math.round(1e6*Math.random());i._props.id=m,s.push(m)}else i.addClass("_todo");for(var v in i._class)i._class[v]&&(u+=i._class[v]+" ",c=!0);u+="'",c||(u="");for(var v in i._props)i._props[v]&&(p+=" "+v+"='"+i._props[v]+"'");for(var v in i._css)i._css[v]&&(_+=v+":"+i._css[v]+";",d=!0);for(var v in this._dataset)this._dataset[v]&&(o+="data-"+v+"="+this._dataset[v]);_+="'",d||(_=""),a+="<"+i._tag+u+p+_+h+o+">";for(var v=0;v<i._children.length;v++)a+=l(i._children[v]);return a+=i._text,a+="</"+i._tag+">"};return i=l(this),{ids:s,future:r,event:t,data:n,str:i}},element._setId=function(e,t){var n=t.ids,r=e.attr("id");r&&""!==r&&n.unshift(r);for(var i=0;i<n.length;i++){var s=$("#"+n[i]);-1!==n[i].indexOf("___todo")&&s.attr("id","");var l=t.event[s.attr("event")],h=t.data[s.attr("cache")],a=t.future[s.attr("future")];for(var p in l)for(var _=l[p],u=0;u<_.length;u++)s.bind(p,_[u]);s.data(h),a&&a.call(s)}return t.event.length=0,t.data.length=0,t.future.length=0,t.ids.length=0,e},element._set=function(e,t){return e.find("._todo").add(e).each(function(){var e=t.event[$(this).attr("event")],n=t.data[$(this).attr("cache")],r=t.future[$(this).attr("future")];for(var i in e)for(var s=e[i],l=0;l<s.length;l++)$(this).bind(i,s[l]);$(this).data(n),r&&r.call(this)}),t.event.length=0,t.data.length=0,t.future.length=0,e},element._uper=function(e){return e.replace(/[A-Z]/g,function(e){return"-"+e.toLowerCase()})},element.prototype.addClass=function(e){return-1===this._class.indexOf(e)&&this._class.push(e),this},element.prototype.removeClass=function(e){var t=this._class.indexOf(e);return-1!==t&&this._class.splice(t,1),this},element.prototype.toggleClass=function(e){var t=this._class.indexOf(e);return-1===t?this._class.push(e):this._class.splice(t,1),this},element.prototype.dataset=function(e,t){if(1===arguments.length){if($.is.isString(e))return this._dataset[element._uper(e)];for(var n in e)this._dataset[element._uper(n)]=e[n]}else 2===argument.lenght&&(this._dataset[element._uper(e)]=t);return this},element.prototype.attr=function(e,t){if(1===arguments.length){if($.is.isString(e))return this._props[e];$.extend(this._props,e)}else 2===arguments.lenght&&(this._props[e]=t);return this},element.prototype.css=function(e,t){if(1===arguments.length){if($.is.isString(e))return this._css[e];$.extend(this._css,e)}else 2===arguments.lenght&&(this._css[e]=t);return this},element.prototype.first=function(){return this._children[0]},element.prototype.last=function(){return this._children[this._children.length-1]},element.prototype.next=function(){if(this._parent){var e=this._parent._children.indexOf(this);if(-1!==e&&(e+=1,e<this._parent._children.length))return this._parent._children[e]}return null},element.prototype.prev=function(){if(this._parent){var e=this._parent._children.indexOf(this);if(-1!==e&&(e-=1,e>=0))return this._parent._children[e]}return null},element.prototype.children=function(e){return 0===arguments.length?this._children:this._children[e]},element.prototype.remove=function(){var e=this._parent._children.indexOf(this);return-1!==e&&this._parent._children.splice(e,1),this},element.prototype.clone=function(){var e=new element;for(var t in this)e.hasOwnProperty(t)&&(e[t]=this[t]);return e},element.prototype.div=function(e,t,n){return this.append("div",e,t,n)},element.prototype.span=function(e,t,n){return this.append("span",e,t,n)},element.prototype.append=function(e,t,n,r){if(e instanceof element)return this._children.push(e),this;if($.is.isString(e)){var i=new element(e,t,n,r);return i._parent=this,this._children.push(i),i}return this},element.prototype.parent=function(e){if(0===arguments.length)return this._parent;if($.is.isNumber(e)){for(var t=0,e=parseInt(e),n=this;n&&e>t;)n=n._parent;return n}},element.prototype.perpend=function(e,t,n,r){if(e instanceof element)return this._children.splice(0,0,e),this;var i=new element(e,t,n,r);return i._parent=this,this._children.splice(0,0,i),i},element.prototype.empty=function(){return this._children.length=0,this},element.prototype.wrap=function(e,t,n,r){if(e instanceof element){if(e._parent=this._parent,this._parent){var i=this._parent._children.indexOf(this);-1!==i&&this._parent._children.splice(i,1,e)}e._children.push(this),this._parent=e}else{var s=new element(e,t,n,r);if(s._children.push(this),s._parent=this._parent,this._parent){var i=this._parent._children.indexOf(this);-1!==i&&this._parent._children.splice(i,1,s)}this._parent=s}return this},element.prototype.before=function(e,t,n,r){if(this._parent){var i=this._parent._children.indexOf(this);if(e instanceof element)-1!==i&&(i-1>=0?this._parent._children.splice(i-1,1,e):this._parent._children.push(e),e._parent=this._parent);else{var s=new element(e,t,n,r);i-1>=0?this._parent._children.splice(i-1,1,s):this._parent._children.push(s),s._parent=this._parent}}return this},element.prototype.after=function(e,t,n,r){if(this._parent){var i=this._parent._children.indexOf(this);if(e instanceof element)-1!==i&&(i+1<this._parent._children.length?this._parent._children.splice(i+1,1,e):this._parent._children.push(e),e._parent=this._parent);else{var s=new element(e,t,n,r);i+1<this._parent._children.length?this._parent._children.splice(i+1,1,s):this._parent._children.push(s),s._parent=this._parent}}return this},element.prototype.html=function(e){if(0===arguments.length){var t=" ",n="",r="",i=" style='",s=" class='",l="",h=!1,a=!1;for(var p in element._class)element._class[p]&&(s+=element._class[p]+" ",h=!0);s+="'",h||(s="");for(var p in element._props)element._props[p]&&(r+=" "+p+"='"+element._props[p]+"'");for(var p in element._css)element._css[p]&&(i+=p+":"+element._css[p]+";",a=!0);for(var p in this._dataset)this._dataset[p]&&(l+="data-"+p+"="+this._dataset[p]);i+="'",a||(i=""),n+="<"+element._tag+s+r+i+t+l+">";for(var p=0;p<element._children.length;p++)n+=cle(element._children[p]);return n+="</"+element._tag+">"}return this._text=e,this},element.prototype.future=function(e){return $.is.isFunction(e)&&(this._future=e),this},element.prototype.bind=function(e,t){return this._event||(this._event={}),this._event[e]||(this._event[e]=[]),this._event[e].push(t),this},element.prototype.data=function(e,t){return this._data||(this._data={}),2===arguments.length?(this._data[e]=t,this):this._data[e]},element.prototype.removeData=function(e){if(0===arguments.length)this._data={};else if(this._data[e]){var t={};for(var n in this._data)n!==e&&(t[n]=this._data[n]);this._data=t}return this},element.prototype.unbind=function(e,t){if(0===arguments.length)this._event=null;else if(1===arguments.length)this._event[e]&&(this._event[e].length=0);else if(2===arguments.length&&this._event[e]){var n=this._event[e].indexOf(t);-1!==n&&this._event[e].splice(n,1)}return this},element.prototype.clean=function(){this._tag=null,this._class.length=0,this._dataset=null,this._props=null,this._css=null,this._event=null,this._data=null,this._parent=null,this._future=null;for(var e=0;e<this._children.length;e++)this._children[e].clean();this._children.length=0},element.prototype.insertBefore=function(e){return element.ad.call(this,e,"insertBefore")},element.prototype.insertAfter=function(e){return element.ad.call(this,e,"insertAfter")},element.prototype.prepend=function(e){return element.ad.call(this,e,"prepend")},element.prototype.appendTo=function(e){return element.ad.call(this,e,"appendTo")},element.prototype.replaceWith=function(e){return element.ad.call(this,e,"replaceWith")},element.prototype.isBuilder=function(){return this instanceof element},element.ad=function(e,t){var n=null;if(this._issvg){var r=null,i=null;return-1!==$.browser.name().indexOf("msie")?(r=element._compile.call(this,!0),i=r.str):(r=element._compile.call(this),i=r.str),n="svg"!==this._tag?$().create("svg","http://www.w3.org/2000/svg").attr({width:e.width(),height:e.height()}).append($.svg(i))[t](e):$.svg(i)[t](e),-1!==$.browser.name().indexOf("msie")?element._setId(n,r):element._set(n,r)}var r=element._compile.call(this),i=r.str;return n=$(i)[t](e),element._set(n,r)},$.builder.fn=element.prototype;