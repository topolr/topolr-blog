/**
 * @packet site.admin;
 * @require site.service.admin;
 * @require site.service.base;
 * @require site.service.apiconfig;
 * @require util.uikit;
 * @require util.images;
 * @template site.template.admintemp;
 * @css site.style.main;
 * @map (js)lib.ace.ace;
 */
Module({name:"login",extend:"view",className:"login",template:"@admintemp.login",services:{admin:"@admin.userservice"},init:function(){this.render()},find_submit:function(e){e.click(function(){var e=this.finders("username").val(),t=this.finders("password").val();e&&t?this.getService("admin").trigger("login",{username:e,password:t}).scope(this).done(function(e){this.dispatchEvent("redirectPage",{url:"admin"})}).fail(function(){$.toast("username or password is not matched")}):$.toast("username or password can not empty")}.bind(this))}}),Module({name:"adminhead",extend:"view",className:"adminhead",template:"@admintemp.adminhead",init:function(){var e=this;this.render(),this.dom.find("a").each(function(){$(this).click(function(t){e.dispatchEvent("openPage",{url:$(this).attr("href")}),t.preventDefault()})})}}),Module({name:"articlelist",extend:"view",className:"list",template:"@admintemp.articlelist",autodom:!0,services:{scroll:"@base.scrollservice",list:"@base.listservice"},option:{service_list:{url:require("@apiconfig").get("articlelist"),detail:require("@apiconfig").get("articledetail"),pagesize:10}},bind_add:function(e){this.dispatchEvent("openPage",{url:"admin/addarticle"})},onnodeinserted:function(e){var t=this;$(e).find("a").each(function(){$(this).click(function(e){console.log($(this).group().cache()),t.dispatchEvent("openPage",{url:$(this).attr("href"),data:$(this).group().cache()}),e.preventDefault()})})},group_item:function(e){e.items("remove").click(function(){console.log($(this).group().cache())})},service_scroll:function(){var e=this.finders("loading").get(0).offsetTop;e&&$("body").scrollTop()>this.finders("loading").get(0).offsetTop-$(window).height()&&(this.finders("loading").show(),this.getService("list").trigger("next").scope(this).always(function(){this.finders("loading").hide()}))},service_firstpage:function(){this.dispatchEvent("listdone")}}),Module({name:"editor",setEditor:function(e){$().create("script").attr("src",module.currentPath+"lib/ace/ace.js").attr("type","text/noload").appendTo("head"),module.getMapSource("@ace").scope(this).done(function(){var t=$.util.randomid(8);$().create("pre").css({height:"600px"}).attr("id",t).appendTo(e);var i=window.ace.edit(t);i.setTheme("ace/theme/github"),i.getSession().setMode("ace/mode/markdown"),this.editor=i,this.dispatchEvent("editdone")})}}),Module({name:"editarticle",extend:["viewgroup","@.editor"],className:"editarticle",layout:"@admintemp.editarticle",autodom:!0,services:{article:"@admin.articleservice"},option:{imageType:"@images.imagesuploader"},find_editor:function(e){this.setEditor(e)},find_submit:function(e){e.click(function(){var e=this.groups("title").items("input").val(),t=this.groups("desc").items("input").val(),i=this.editor.getValue(),n=!1;if(e?t?i?n=!0:$.toast("content can not empty"):$.toast("desc can not empty"):$.toast("title can not empty"),n){var o={title:e,desc:t,content:i};this.onsubmit&&(o=this.onsubmit(o)),$.loadingbar().showLoading(),this.getChildAt(0).upload(o,function(){$.loadingbar().showSuccess()},function(){$.loadingbar().showError()})}}.bind(this))},setContent:function(e){this.update(e)},onsubmit:function(e){var t=$.serialize.queryObject(window.location.href);return t?$.extend(e,{id:t.id}):e},event_editdone:function(){var e=$.serialize.queryObject(window.location.href);e&&(this.getChildAt(0).option.url=sitePath+"/api/admin/article/edit",this.getService("article").trigger("fetch",e).scope(this).then(function(e){this.update(e)},function(e){console.log(e)}))}}),Module({name:"edituserinfo",extend:["view","@.editor"],className:"editarticle",template:"@admintemp.edituserinfo",services:{user:"@admin.userservice"},init:function(){this.render()},find_editor:function(e){this.setEditor(e)},find_submit:function(e){e.click(function(){var e=this.editor.getValue(),t=!1;e?t=!0:$.toast("content can not empty"),t&&(this.info.userinfomd=e,$.loadingbar().showLoading(),this.getService("user").trigger("edit",this.info).scope(this).done(function(){$.loadingbar().showSuccess()}).fail(function(){$.loadingbar().showError()}))}.bind(this))},setContent:function(e){this.editor.setValue(e)},event_editdone:function(){var e=this.getService("user").action("get");this.info=e[0],this.editor.setValue(e[0].userinfomd)}}),Module({name:"noadminhead",extend:"view",className:"adminhead",template:"@admintemp.noadminhead",init:function(){this.render()}}),Module({name:"copyright",extend:"view",className:"copyright",template:"@admintemp.copyright",init:function(){this.render()}});