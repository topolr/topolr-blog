/**
 * @packet site.site;
 * @require site.setting;
 * @require util.router;
 * @require config;
 * @require site.service.site;
 * @require site.service.base;
 * @require site.service.apiconfig;
 * @css site.style.grid;
 * @css site.style.main;
 * @css site.style.style;
 * @template site.template.sitetemp;
 */
Module({name:"pagecontainer",extend:"viewgroup",init:function(e){var t=this,i={},n=require("@config");this._router=require("@router")(sitePath);for(var s in n){var a=s;"/"!==a[a.length-1]?i[a+"/"]=n[s].name:i[a]=n[s].name}for(var s in i)this._router.bind(s,function(e){t.openPage(i[e.action],e)});this._router.run()},openPage:function(e,t){$("body").scrollTop(0),this.children[0]&&this.children[0].remove(),this.addChild({type:"@.page",parameters:t,option:e,container:this.dom})},event_openPage:function(e){this._router.open(e.data.url,e.data.data,e.data.title),e.stopPropagation()},event_redirectPage:function(e){this._router.edit(e.data.url,e.data.data,e.data.title),e.stopPropagation()}}),Module({name:"page",extend:"viewgroup",className:"page",layout:"@sitetemp.page",services:{article:"@site.docservice"},option:{modules:[{type:"",option:{}}]},setContentPage:function(){this.parameters.query?this.getService("article").trigger("fetch",this.parameters.query).scope(this).then(function(e){this.getChildAt(0).update(e),this.getChildAt(1).update(e.content),this.dispatchEvent("contentdone")}):this.dispatchEvent("gotoPage",{url:"404"})}}),Module({name:"base",extend:"view",className:"base",template:"@sitetemp.base",services:{scroll:"@base.scrollservice"},init:function(){this.render()},find_link:function(e){var t=this;e.find("a").each(function(){$(this).click(function(e){t.dispatchEvent("openPage",{url:$(this).attr("href")}),e.preventDefault()})})},find_icon:function(e){var t=this;e.click(function(e){t.dispatchEvent("openPage",{url:$(this).attr("href")}),e.preventDefault()})},find_about:function(e){var t=this;e.click(function(e){t.dispatchEvent("openPage",{url:$(this).attr("href")}),e.preventDefault()})},service_scroll:function(e){var t=e.scroll,i=this.finders("bg");t>i.height()?this.dom.addClass("show"):this.dom.removeClass("show")}}),Module({name:"nofind",extend:"view",className:"nofind",template:"@sitetemp.nofind",init:function(){this.render()}}),Module({name:"list",extend:"view",className:"list",template:"@sitetemp.list",autodom:!0,option:{service_list:{url:require("@apiconfig").get("articlelist"),detail:require("@apiconfig").get("articledetail"),pagesize:10}},services:{scroll:"@base.scrollservice",list:"@base.listservice"},onnodeinserted:function(e){var t=this;$(e).find("a").each(function(){$(this).click(function(e){t.dispatchEvent("openPage",{url:$(this).attr("href"),data:$(this).group().cache()}),e.preventDefault()})})},service_scroll:function(){if(this.finders("loading").get(0)){var e=this.finders("loading").get(0).offsetTop;e&&$("body").scrollTop()>this.finders("loading").get(0).offsetTop-$(window).height()&&(this.finders("loading").show(),this.getService("list").trigger("next").scope(this).always(function(){this.finders("loading").hide()}))}},service_firstpage:function(){this.dispatchEvent("listdone")}}),Module({name:"copyright",extend:"view",className:"copyright",template:"@sitetemp.copyright",init:function(){this.render()}}),Module({name:"about",extend:"view",className:"about",template:"@sitetemp.about",services:{base:"@site.baseservice"},init:function(){this.render(),this.getService("base").scope(this).done(function(e){this.finders("content").html(e[0].userinfohtml)})}}),Module({name:"paperheader",extend:"view",className:"paperheader",template:"@sitetemp.paperheader",autodom:!0,services:{scroll:"@base.scrollservice"},init:function(){this.dom.height($(window).height()),this.render({})},find_arrow:function(e){e.click(function(){$("body").scrollingTop(2*$(window).height()/3)})},service_scroll:function(e){var t=e.scroll,i=this.finders("bg");i.css("opacity",1*(t/i.height())),t>i.height()?this.dom.addClass("show"):this.dom.removeClass("show")}}),Module({name:"papercontent",extend:"view",className:"papercontent",template:"@sitetemp.papercontent",autodom:!0,init:function(){this.render("no content")}}),Module({name:"paperfooter",extend:"view",className:"paperfooter",template:"@sitetemp.paperfooter",init:function(){this.render()},find_home:function(e){var t=this;e.click(function(e){t.dispatchEvent("openPage",{url:$(this).attr("href")}),e.preventDefault()})}});